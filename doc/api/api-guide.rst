=========
API guide
=========

CKAN offers a flexible and robust APIs to interact with the CKAN site.\

Official CKAN API `guide <https://docs.ckan.org/en/2.11/api/index.html>`_

---------------------
Legacy APIs
---------------------
CKAN still has a few `legacy APIs <https://docs.ckan.org/en/2.11/api/legacy-api.html>`_ for backwards-compatibility, but support for new CKAN features will not be added to these APIs. These endpoints are not supported and will be removed in the future.

---------------------
Making an API request
---------------------
To call the CKAN API, a JSON dictionary needs to be posted in an HTTP POST request to one of CKAN APIs URLs.

There are a few ways to call the APIs:

#. Through command-line Curl::

    curl https://demo.ckan.org/api/3/action/group_list

#. Using Python's ``urllib`` module::

    response = urllib.request.urlopen('http://demo.ckan.org/api/3/action/group_list', data_string)

#. Using Puython's Requests module (preffered)::

    response = requests.post('http://demo.ckan.org/api/3/action/group_list', json=dataset_dict)

.. Note::

  It's best to specify the CKAN version (``.../api/3/...``) that the request is made with, because this ensures that the API client will work across different sites running different version of CKAN (version 3 is currently the latest).

A response example:

.. code-block:: bash

    {
      "help": "...",
      "result": [
          "data-explorer",
          "department-of-ricky",
          "geo-examples",
          "geothermal-data",
          "reykjavik",
          "skeenawild-conservation-trust"
          ],
      "success": true
    }

* ``success``: ``true`` or ``false``.
* ``help``: the documentation string for the function you called.
* ``result``: the returned result from the function that was called. If there was an error responding the request, the dictionary will contain an ``error`` key with details of the error instead of the ``result`` key. A response dictionary containing an error will look like this:

.. code-block:: bash

    {
      "help": "Creates a package",
      "success": false,
      "error": {
          "message": "Access denied",
          "__type": "Authorization Error"
      }
    }

Response Status codes:

====  ======
Code  Name
====  ======
200   OK
201   OK and new object created (referred to in the Location header)
301   Moved Permanently
400   Bad Request
403   Not Authorized
404   Not Found
409   Conflict (e.g. name already exists)
500   Service Error
====  ======

---------------------
Authentication and API tokens
---------------------
Some API functions require authorization. Provide the API token in the request header of the API request, like so:

#. Curl::

    curl -H "Authorization: XXX" https://demo.ckan.org/api/3/action/am_following_user?˓→id=markw

#. Python::

    headers = {'Authorization': api_token}
    response = requests.post('http://demo.ckan.org/api/3/action/group_list', json=dataset_dict, headers=headers)

API tokens can be generated by logged-in users through their profiles. Site maintainers can also edit the API token generator settings, like setting the token expiration time, in the site configuration file (``conf.ini``).

---------------------
API Examples
--------------------- 
Here's a list of most useful API request examples and their descriptions: `API examples <https://docs.ckan.org/en/2.11/api/index.html#api-examples>`_

Python ode example can be found in the ``.../api/api-example-usage.py`` file.
